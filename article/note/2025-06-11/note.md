警告  
ほぼすべてのページに書かなければいけないことですが、、、
初心者が調べつつ書いている記事のまとめです。  
多分これより賢い手段があるかもですしとんでもない嘘書き連ねてるかもしれないです。  
何が起きても保証しませんし、あくまで参考程度に見ていってください。  

# 目次
* <a href="#そもそも" class="index-tag">そもそも</a>
* <a href="#環境の用意" class="index-tag">環境の用意</a>
* <a href="#第一の壁" class="index-tag">壁</a>
* <a href="#記事データの処理" class="index-tag">記事データの処理</a>
* <a href="#マークダウンの独自記法の作成" class="index-tag">マークダウンの独自記法の作成</a>
* <a href="#プレーヤー" class="index-tag">Projectページの処理</a>
* <a href="#今後" class="index-tag">まとめ</a>

# そもそも
第一にサイトを移転しようと思った理由。  
まあ単純な話である。  
もともとGoogleSitesを利用し作っていたのだがどうにもダサい。  
テンプレからは離れられないしjavascript組み込めないし(出来はするんだけども)

ならいっそHTML/CSS系一応覚えているし作ってみるかというのが発端である。
<br><br>
WordPressとか使えばもっと楽にできるのに・・・(某ロボット)とか言った奴は許さぬ  
まあ初心者の努力というものを見ていって欲しい。

### 一応の免責
サイトを作る上で数多のサイト様とAIツールに助けを求める機会があったが故に、もっと効率の良い手段なんかがあるかもしれないが、当方の技術不足及びリサーチ能力の欠如によりその境地に至らなかったが故実現できなかった部分も多い。その点ご承知おきいただきたい。

# 本題
## 環境の用意
まずサイトをどこ経由で公開すべきか。  
色々考えていたが結局GitHubPagesにした。
中高大の先輩が使っていてあー便利そうだなと思ったというのもあるが、自鯖で組んで逐一アップロードして編集版と本番版を容易するのは混同しそうであり、GitHubにコミットする形式のほうが使い易いのではという目論見である。
当ドメイン(kamamasastudio.com)自体はGoogleSites時代から使っている(思えばもう6年近く保持しているのか)ドメインを利用した。  
ダウンロードページに関して、元々はfirestorageとGoogleドライブをメインに使っていたのだが、しばらくぶりにアクセスしようとしたらfirestorageのリンクが全滅しており、なおかつドライブの15GBの制約が厳しい、いちいち画面挟むのがしんどいという面で、サブドメイン(dl.kamamasastudio.com)に自鯖を紐づけ、一括でダウンロードできるようにした。

## 第一の壁
そこまでは良かったのだが、ここで第一の壁にぶつかることになる。  
鯖データの管理にHFSを利用しているのだが、どうにもこいつが使い勝手が悪い。  
うまくHTTPSで公開できない上にリファレンスの文献が尽くデスクトップで動くexeなのだが現環境ではlocalhostのウェブ完結という、、、  
データ頒布の上で逐一「このファイルはHTTPS経由のやつじゃないし危険です！ウイルスだ！わあ！」ってブラウザに叫ばせるのはあまりに不細工であり、なんとかHTTPSにて認証を通すべきであると考えた。  
という理由でGoogle先生に泣きついた結果、どうにもCloudFlare経由でトンネル作ればHTTPS経由で公開できる、っぽい。
この辺に関しては理解が浅くどこで嘘つくかわからんので俺に聞くより他に聞け。  
おそらく HFS→CloudFlare→ドメイン という流れにすることでHTTPSで通すだけでなく、よりセキュアにデータを転送できる？っぽい。よくわかんない。

## 記事データの処理
次、このページもそうだが記事の管理について。  
元々HTML直書きで一括管理したろと思っていたが、冷静になって考えればあまりに馬鹿がすぎる行為である。  
ソース/文章の可読性が下がるだけでなく、html/css/jsが各項目事に増えるし、逐一本文書いて見だしリンク付けてetc,etcと言うのはあまりにめんどくさい。  
そこで目をつけたのがJSONでの記事管理とマークダウン記法だ。  
JSONに関してはごく単純。記事の作成日時やタイトル、カテゴリを配列で記述し、javascript経由で動的にHTMLコンテンツを生成することで、JSONファイルを弄るだけで項目を自動で追加できるようにした。  
```json "このノートのJSON部分"
  "articles": [
    {
        "id": "2025-06-11",
        "title": "サイト内に隠しこんだいろんな技術覚書",
        "publishDate": "2025/05/11",
        "updateDate": "2025/06/14",
        "summary": "ちょっと本気出して色々楽に弄れるようにしてあるので一応まとめてみる",
        "thumbnail": "article/note/2025-06-11/top_img.jpg",
        "hasImage": true,
        "tags": ["HTML","CSS","JS","Markdown","ClaudFlare","HFS"],
        "category": "技術"
    }
```
マークダウンに関してはGitHubや普段Discordを利用する人間にとっては割と馴染み深い記法であろう  

```
# でっかい見出し
## 中くらいの見出し
**太字とか** *斜体* とか
~~打ち消しも~~ `#ABCDEF` カラーコード表記も作れるよ
```

っていうやつだ。今回はこいつで記事を作成し、またボタンなども記述できるように改良したものを利用することにした。  
<br>
さて、この記事の一番身になる部分を書いていく。

## マークダウンの独自記法の作成
一言で言おう。正規表現。  
まあこれでわかった人はブラウザバックしてもらって構わないが一応最後まで見ていってね  
<br>
マークダウンで記述していく中で機能性ちょっと足りんなぁと思った部分が数か所ある。
* ボタンの表示
* コードブロックの表示(着色)
* コードブロックのタイトルの表示

それぞれの実装方法として、マークダウンの中に特定の文字列(コマンド)を用意し、それに基づいてマークダウンをHTMLに変換するタイミングにボタン表示などを差し込むようにした。  
### ボタンの表示
サイトを作る上で必須となってくるのがボタンである。  
特にこういうサイトにおいてダウンロードボタンやリンクのボタンなどは不可欠なものであり記述回数も多いため、マークダウンで単純に記述できるようにしてみた。  
例えば  
```markdown
[ !link](https://www.google.com "Google")
```
みたく記述すれば、正規表現側で
```markdown
[!link](https://www.google.com "Google")
```
```javascript "コード部分"
//resultにマークダウンの内容が代入される
result = result.replace(/\[!link\]\(([^)\s]+)(?:\s+"([^"]+)")?\)/g, (match, url, text) => {
    const buttonText = text || 'リンクを開く';
    const target = url.startsWith('http') ? ' target="_blank" rel="noopener noreferrer"' : '';
    return `<a href="${url}" class="btn btn-link"${target}><i class="fa-solid fa-link"></i> ${buttonText}</a>`;
});
```
と変換され、結果<br>
[!link](https://www.google.com "Google")
<br>のようにボタンが簡単に生成できるというわけだ。  
またボタンの表示だけでなく配置なども指定できるようにしてある。これがかなり便利。HTMLとCSSを逐一記述しなくてすむので重宝している。

### コードブロックの表示(着色)
マークダウン形式でコードを記述するというのはブロックとして表示できるのでかなり見やすいことには見やすいのだが、デフォルトだと
```text "Pythonのコード"
async def transcribe(self, file_path):
    print("音声認識開始/ファイルパス:", file_path)
    if os.path.exists(file_path):
        print("ファイル存在確認")
    else:
        print("ファイルが存在しません")
        return
    result = await asyncio.to_thread(self.model.transcribe, file_path, language="ja", **FFMPEG_OPTIONS)
    print("認識結果:", result)
```

のようになってメモ帳で開いたみたいな、ばーか見づらい文章となってしまう。  
そこで使ったのがPrism.jsという化け物みたいなブツだ。  
<a href="https://prismjs.com" target="_blank" rel="noopener noreferrer">公式ページ</a>からJSとCSSをダウンロードし読み込ませるとこの文章が

```python "Pythonのコード"
async def transcribe(self, file_path):
    print("音声認識開始/ファイルパス:", file_path)
    if os.path.exists(file_path):
        print("ファイル存在確認")
    else:
        print("ファイルが存在しません")
        return
    result = await asyncio.to_thread(self.model.transcribe, file_path, language="ja", **FFMPEG_OPTIONS)
    print("認識結果:", result)
```

こんなに見やすくなる。いやほんとにこれすごい。

### コードブロックのタイトル
となると欲しくなってくるのがタイトルだ。~~二度も言うのは億劫なので~~仕様について雑に説明すると、ボタンの時と同様に正規表現でコードブロック部分の指示を確認し表示させている。
```markdown "マークダウン側","border-left-color: #AAAAAA"
` ` `python "タイトル","独自のCSSコマンドも入力できる"
```

とすればCSS側も自由に変更もできたりする、意外に柔軟。  
その気になれば  

```text "ぱーりーぴーぽー","border-left-color: #e6b422; color:black; background: linear-gradient(to right,#e60000,#f39800,#fff100,#009944,#0068b7,#1d2088,#920783);"
うぇーい
```

なんてのも表示できたりする。

## プレーヤー
<a href="/site_data/html/projects.html" target="_self">ProjectのMusicタブ</a>を開くとわかるが、音源データをプレビューする部分を単純にaudio controlで指定するのではなく、JavaScriptで記述してサイトの雰囲気との親和性を上げてある。  
のだが、正直ここに関しては基本部分をClaude君にぶん投げて細かい修正だけをしているだけなので読解しきれていない。(怠惰)  
ので書けることは少ない。  
一応演出としてシーク機能を使用中に音量を25%まで一時的に落としてより演出的なシークを再現したりもしているが割とどうでもいいことなので割愛。

## 今後
一応ある程度形にはなっているが、今後もちょくちょく変更を加えより便利にしていきたいと思っている。  
今回はプレーヤー部分などは全部Claudeにぶん投げたが技術力を上げまた再戦したいとおもう。